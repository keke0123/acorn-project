<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="search">
	<select id="getList" parameterType="string" resultType="searchDto">
	SELECT a.nick, a.name, a.id, b.count_follow
	FROM (
    	SELECT id_follow, count(id_follow) AS count_follow
    	FROM acorn_follow
    	GROUP BY id_follow
        ) b, (
					SELECT nick, name, id
					FROM acorn_user
					WHERE nick LIKE '%'||#{keyword}||'%' 
						OR name LIKE '%'||#{keyword}||'%'
					) a
    WHERE b.id_follow = a.id
	</select>
	<select id="getListTag" parameterType="string" resultType="searchDto">
		SELECT a.nick, a.name, b.id_writer as id, b.count_tag as count
		FROM (
			SELECT id_writer, count(id_writer) AS count_tag
			FROM
			(
				SELECT b.id_writer
			    FROM
				(
					SELECT num_board, tag
					FROM acorn_tag
					WHERE tag LIKE '%'||#{keyword}||'%' 
				) t, acorn_board b
				WHERE b.num_board = t.num_board
			)
			GROUP BY id_writer
		) b, acorn_user a
		WHERE b.id_writer=a.id
		ORDER BY count_tag DESC
	</select>
	<select id="getListHuman" parameterType="string" resultType="searchDto">
		SELECT a.nick, a.name, a.id, b.count_follow
	FROM (
    	SELECT id_follow, count(id_follow) AS count_follow
    	FROM acorn_follow
    	GROUP BY id_follow
        ) b, (
					SELECT nick, name, id
					FROM acorn_user
					WHERE nick LIKE '%'||#{keyword}||'%' 
						OR name LIKE '%'||#{keyword}||'%'
					) a
    WHERE b.id_follow = a.id
	</select>
	<select id="getListDefault" resultType="searchDto">
		SELECT a.nick, a.name, a.id, b.count_follow
	FROM (
    	SELECT id_follow, count(id_follow) AS count_follow
    	FROM acorn_follow
    	GROUP BY id_follow
        ) b, (
					SELECT nick, name, id
					FROM acorn_user
					) a
    WHERE b.id_follow = a.id
	
	</select>
		<!-- OR writer LIKE '%'||#{writer}||'%' -->

</mapper>























